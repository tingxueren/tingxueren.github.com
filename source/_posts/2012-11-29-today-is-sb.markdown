---
layout: post
title: "today is SB"
date: 2012-11-29 20:26
comments: true
categories: 
---

这两天遇到了很 SB 的事情，在脑袋冲动的情况下做出了很多 SB 的不理智的决定。记录下来，等以后再 SB 的时候拿出来看看。

## 缘起

一切的开端始于昨天早上，一早到实验室就发现我无法通过 SSH 登陆到我的 VPS 了。虽然现在手里的这个 VPS 有很多的不足：OpenVZ 架构的，空间很小，最近服务不稳定，特别是最近基本上三天两头的宕机。 但是总体上还是不错的，流量不限制，延迟很小，在上面搭建的 openvpn 虽然已经被 #GFW 干废掉了，但是添加上前端代理后还是可以用的，最重要的还是比较便宜，一个月不到40块还是能接受的。

## 发展

突然不能 SSH 登录了，但是网站和 openvpn 都正常的工作，第一个念头是伟大的 #GFW 的干扰，#GFW 做这件事情不是一次两次了。但是挂上全局 VPN 后依然无法 SSH 登陆 。看了不是 #GFW 的问题，以为是 iptables 的问题了，进入管理网页清空 iptables 规则后还是不行，通过网页重启了机器后还是不行，火大了。运营商提供的网页的 consle的端口也被禁用了，救命稻草也没了，不清楚到底出现了什么问题，给运营商发邮件但是迟迟收不到邮件。脑子抽了准备恢复系统了，还好 ftp 还是正常的，通过 ftp 备份了不少配置和网站的文件，还好应该损失不大。

等系统重置完成了，收到了回复的邮件：运营商在做虚拟机的迁移，在此期间 VPS 可能工作不正常。我估计 SSH 无法登陆的原因是但是我的 VPS 正在做迁移，VPS 其实是工作正常的，应该是为了迁移的安全运营商暂停了 SSH 的登陆。把系统重装了纯粹是瞎忙活，没办法了，系统重置了还是要把它恢复原装的。按照正常的步骤，登陆，升级，建立账户，设置配置。重启，然后又进不去了，诡异的画面一再出现，把我郁闷的不行，都要吐血了。

## 高潮

昨天夜里又尝试了好几次，恢复了几次系统。问题依旧，开始能登上，升级系统，打打补丁后又登陆不上去了，仔细的排查过了 iptables , sshd_config 都没什么问题。然后就想干脆换个 VPS 提供商吧。逛逛网站发现了 YardVPS ，现在有7折的优惠，一个月35块，和我现在用的差不多。一冲动又拍脑袋买了个，忘记了网上各位对他家服务的诟病 。开通邮件倒是很快收到了，控制面板上也显示了 VPS 已经再线，但是就是 ping 不通，也无法 SSH 登陆。YardVPS 立马给我展示了他们的糟糕的服务，邮件发了，后台看到正在跑了，但是其实 VPS 还是没有开通。google 了下看来和我有同样遭遇的不只一个人。没办法只好发 ticket，杯具的美国时间还没上班，要等到美国人上班了才会处理 ticket，怀着郁闷的心情睡觉去了。

## 后续

早上来了，发现新买的这个 VPS 终于开通了，配置下吧。发现除了客服不给力和美国线路延迟大上传下载比较慢之外，其他的基本比较满意。上午收到了原来的 VPS 提供商的邮件，维护结束一切正常。但是我的 VPS 还是无法用 SSH 登陆，重新生成系统，打补丁，重启，又不能登陆系统了。次凹，到底是怎么回事，突然我想起来了在升级系统前是可以登陆的，升级系统后就不可以登陆了，问题一定出在了系统更新的头上。再次生成系统，慢慢的一步步升级系统，终于找到原因了，原来系统升级的时候会更改 `/etc/init/ssh.conf` 这个文件，本来默认的规则是保留现在用的，但是脑子抽了，就选择成了升级规则了，新规则估计和主机不兼容什么的然后就不能用，好郁闷啊，原来事情就是这么简单，搞得我折腾了 2 天，重装了系统不下于 10 次。我真的是个 SB。

## 终章

现在 VPS 终于恢复到了和一前一样了，貌似跑的也很顺畅。一番折腾纠结了 2 天，多买了个不需要的 VPS ，浪费了一个月钱。现在只能想让两个都跑着，观察下，看那个更稳定下个月就用哪个了。看来“冲动是魔鬼”确实所言不虚，脑子不冷静的状态下做的决定往往会把事情搞的更糟糕，引以为戒吧，以后再犯二的时候就回头来看看这篇帖子。




